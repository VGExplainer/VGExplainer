Description of CVE-2015-8961(CWE416): The __ext4_journal_stop function in fs/ext4/ext4_jbd2.c in the Linux kernel before 4.3.3 allows local users to gain privileges or cause a denial of service (use-after-free) by leveraging improper access to a certain error field. "err = jbd2_journal_stop(handle);" may free 'handle', and "return handle->h_err ? handle->h_err : err;" access 'handle->h_err'.

Patch:
diff --git a/fs/ext4/ext4_jbd2.c b/fs/ext4/ext4_jbd2.c
index d4184318181878..e770c1ee4613ed 100644
--- a/fs/ext4/ext4_jbd2.c
+++ b/fs/ext4/ext4_jbd2.c
@@ -88,13 +88,13 @@ int __ext4_journal_stop(const char *where, unsigned int line, handle_t *handle)
 		return 0;
 	}
 
+	err = handle->h_err;
 	if (!handle->h_transaction) {
-		err = jbd2_journal_stop(handle);
-		return handle->h_err ? handle->h_err : err;
+		rc = jbd2_journal_stop(handle);
+		return err ? err : rc;
 	}
 
 	sb = handle->h_transaction->t_journal->j_private;
-	err = handle->h_err;
 	rc = jbd2_journal_stop(handle);
 
 	if (!err)

Explanation of VGExplainer: We can see the vulnerability path clearly in lineï¼š "if (!handle->h_transaction) {", "err = jbd2_journal_stop(handle);", "return handle->h_err ? handle->h_err : err;"
